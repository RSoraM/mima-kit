// * Functions

function createMask(n: number) {
  let mask = 0n
  for (let i = 0; i < n; i++) {
    mask = (mask << 1n) | 1n
  }
  return mask
}

// * Interfaces

/**
 * 伪射坐标表示的椭圆曲线的点
 *
 * Affine Coordinates of Elliptic Curve Point
 */
export interface FpECPoint {
  isInfinity?: boolean
  x: bigint
  y: bigint
}

/**
 * 素域椭圆曲线参数
 *
 * Prime Field Elliptic Curve Parameters
 */
export interface FpECParams {
  /** Prime */
  readonly p: bigint
  /** Coefficient a */
  readonly a: bigint
  /** Coefficient b */
  readonly b: bigint
  /** Base point */
  readonly G: Readonly<FpECPoint>
  /** Order */
  readonly n: bigint
  readonly n_mask: bigint
  readonly n_bit_length: number
  /** co-factor */
  readonly h: bigint
}

export interface F2mECPoint extends FpECPoint {
}

/**
 * 二元域椭圆曲线参数
 *
 * Binary Field Elliptic Curve Parameters
 */
export interface F2mECParams {
  readonly m: number
  readonly f: (x: bigint) => bigint
  readonly a: bigint
  readonly b: bigint
  readonly G: Readonly<F2mECPoint>
  readonly n: bigint
  readonly n_mask: bigint
  readonly n_bit_length: number
  readonly h: bigint
}

// * SM2 Prime Curve

export const sm2p256v1: FpECParams = Object.freeze({
  p: 0xFFFFFFFE_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_00000000_FFFFFFFF_FFFFFFFFn,
  a: 0xFFFFFFFE_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_00000000_FFFFFFFF_FFFFFFFCn,
  b: 0x28E9FA9E_9D9F5E34_4D5A9E4B_CF6509A7_F39789F5_15AB8F92_DDBCBD41_4D940E93n,
  G: {
    x: 0x32C4AE2C_1F198119_5F990446_6A39C994_8FE30BBF_F2660BE1_715A4589_334C74C7n,
    y: 0xBC3736A2_F4F6779C_59BDCEE3_6B692153_D0A9877C_C62A4740_02DF32E5_2139F0A0n,
  },
  n: 0xFFFFFFFE_FFFFFFFF_FFFFFFFF_FFFFFFFF_7203DF6B_21C6052B_53BBF409_39D54123n,
  n_mask: createMask(256),
  n_bit_length: 256,
  h: 1n,
})

// * SEC-1 Prime Curves

export const secp192k1: FpECParams = Object.freeze({
  p: 0xFFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFE_FFFFEE37n,
  a: 0x00000000_00000000_00000000_00000000_00000000_00000000n,
  b: 0x00000000_00000000_00000000_00000000_00000000_00000003n,
  G: {
    x: 0xDB4FF10E_C057E9AE_26B07D02_80B7F434_1DA5D1B1_EAE06C7Dn,
    y: 0x9B2F2F6D_9C5628A7_844163D0_15BE8634_4082AA88_D95E2F9Dn,
  },
  n: 0xFFFFFFFF_FFFFFFFF_FFFFFFFE_26F2FC17_0F69466A_74DEFD8Dn,
  n_mask: createMask(192),
  n_bit_length: 192,
  h: 1n,
})

export const secp224k1: FpECParams = Object.freeze({
  p: 0xFFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFE_FFFFE56Dn,
  a: 0x00000000_00000000_00000000_00000000_00000000_00000000_00000000n,
  b: 0x00000000_00000000_00000000_00000000_00000000_00000000_00000005n,
  G: {
    x: 0xA1455B33_4DF099DF_30FC28A1_69A467E9_E47075A9_0F7E650E_B6B7A45Cn,
    y: 0x7E089FED_7FBA3442_82CAFBD6_F7E319F7_C0B0BD59_E2CA4BDB_556D61A5n,
  },
  n: 0x01_00000000_00000000_00000000_0001DCE8_D2EC6184_CAF0A971_769FB1F7n,
  n_mask: createMask(225),
  n_bit_length: 225,
  h: 1n,
})

export const secp256k1: FpECParams = Object.freeze({
  p: 0xFFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFE_FFFFFC2Fn,
  a: 0x00000000_00000000_00000000_00000000_00000000_00000000_00000000_00000000n,
  b: 0x00000000_00000000_00000000_00000000_00000000_00000000_00000000_00000007n,
  G: {
    x: 0x79BE667E_F9DCBBAC_55A06295_CE870B07_029BFCDB_2DCE28D9_59F2815B_16F81798n,
    y: 0x483ADA77_26A3C465_5DA4FBFC_0E1108A8_FD17B448_A6855419_9C47D08F_FB10D4B8n,
  },
  n: 0xFFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFE_BAAEDCE6_AF48A03B_BFD25E8C_D0364141n,
  n_mask: createMask(256),
  n_bit_length: 256,
  h: 1n,
})

export const secp192r1: FpECParams = Object.freeze({
  p: 0xFFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFE_FFFFFFFF_FFFFFFFFn,
  a: 0xFFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFE_FFFFFFFF_FFFFFFFCn,
  b: 0x64210519_E59C80E7_0FA7E9AB_72243049_FEB8DEEC_C146B9B1n,
  S: 0x3045AE6F_C8422F64_ED579528_D38120EA_E12196D5n,
  G: {
    x: 0x188DA80E_B03090F6_7CBF20EB_43A18800_F4FF0AFD_82FF1012n,
    y: 0x07192B95_FFC8DA78_631011ED_6B24CDD5_73F977A1_1E794811n,
  },
  n: 0xFFFFFFFF_FFFFFFFF_FFFFFFFF_99DEF836_146BC9B1_B4D22831n,
  n_mask: createMask(192),
  h: 1n,
  n_bit_length: 192,
})

export const secp224r1: FpECParams = Object.freeze({
  p: 0xFFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_00000000_00000000_00000001n,
  a: 0xFFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFE_FFFFFFFF_FFFFFFFF_FFFFFFFEn,
  b: 0xB4050A85_0C04B3AB_F5413256_5044B0B7_D7BFD8BA_270B3943_2355FFB4n,
  S: 0xBD713447_99D5C7FC_DC45B59F_A3B9AB8F_6A948BC5n,
  G: {
    x: 0xB70E0CBD_6BB4BF7F_321390B9_4A03C1D3_56C21122_343280D6_115C1D21n,
    y: 0xBD376388_B5F723FB_4C22DFE6_CD4375A0_5A074764_44D58199_85007E34n,
  },
  n: 0xFFFFFFFF_FFFFFFFF_FFFFFFFF_FFFF16A2_E0B8F03E_13DD2945_5C5C2A3Dn,
  n_mask: createMask(224),
  h: 1n,
  n_bit_length: 224,

})

export const secp256r1: FpECParams = Object.freeze({
  p: 0xFFFFFFFF_00000001_00000000_00000000_00000000_FFFFFFFF_FFFFFFFF_FFFFFFFFn,
  a: 0xFFFFFFFF_00000001_00000000_00000000_00000000_FFFFFFFF_FFFFFFFF_FFFFFFFCn,
  b: 0x5AC635D8_AA3A93E7_B3EBBD55_769886BC_651D06B0_CC53B0F6_3BCE3C3E_27D2604Bn,
  S: 0xC49D3608_86E70493_6A6678E1_139D26B7_819F7E90n,
  G: {
    x: 0x6B17D1F2_E12C4247_F8BCE6E5_63A440F2_77037D81_2DEB33A0_F4A13945_D898C296n,
    y: 0x4FE342E2_FE1A7F9B_8EE7EB4A_7C0F9E16_2BCE3357_6B315ECE_CBB64068_37BF51F5n,
  },
  n: 0xFFFFFFFF_00000000_FFFFFFFF_FFFFFFFF_BCE6FAAD_A7179E84_F3B9CAC2_FC632551n,
  n_mask: createMask(256),
  h: 1n,
  n_bit_length: 256,
})

export const secp384r1: FpECParams = Object.freeze({
  p: 0xFFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFE_FFFFFFFF_00000000_00000000_FFFFFFFFn,
  a: 0xFFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFE_FFFFFFFF_00000000_00000000_FFFFFFFCn,
  b: 0xB3312FA7_E23EE7E4_988E056B_E3F82D19_181D9C6E_FE814112_0314088F_5013875A_C656398D_8A2ED19D_2A85C8ED_D3EC2AEFn,
  S: 0xA335926A_A319A27A_1D00896A_6773A482_7ACDAC73n,
  G: {
    x: 0xAA87CA22_BE8B0537_8EB1C71E_F320AD74_6E1D3B62_8BA79B98_59F741E0_82542A38_5502F25D_BF55296C_3A545E38_72760AB7n,
    y: 0x3617DE4A_96262C6F_5D9E98BF_9292DC29_F8F41DBD_289A147C_E9DA3113_B5F0B8C0_0A60B1CE_1D7E819D_7A431D7C_90EA0E5Fn,
  },
  n: 0xFFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_C7634D81_F4372DDF_581A0DB2_48B0A77A_ECEC196A_CCC52973n,
  n_mask: createMask(384),
  h: 1n,
  n_bit_length: 384,

})

export const secp521r1: FpECParams = Object.freeze({
  p: 0x01FF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFFn,
  a: 0x01FF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFCn,
  b: 0x0051_953EB961_8E1C9A1F_929A21A0_B68540EE_A2DA725B_99B315F3_B8B48991_8EF109E1_56193951_EC7E937B_1652C0BD_3BB1BF07_3573DF88_3D2C34F1_EF451FD4_6B503F00n,
  S: 0xD09E8800_291CB853_96CC6717_393284AA_A0DA64BAn,
  G: {
    x: 0x00C6_858E06B7_0404E9CD_9E3ECB66_2395B442_9C648139_053FB521_F828AF60_6B4D3DBA_A14B5E77_EFE75928_FE1DC127_A2FFA8DE_3348B3C1_856A429B_F97E7E31_C2E5BD66n,
    y: 0x0118_39296A78_9A3BC004_5C8A5FB4_2C7D1BD9_98F54449_579B4468_17AFBD17_273E662C_97EE7299_5EF42640_C550B901_3FAD0761_353C7086_A272C240_88BE9476_9FD16650n,
  },
  n: 0x01FF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFF_FFFFFFFA_51868783_BF2F966B_7FCC0148_F709A5D0_3BB5C9B8_899C47AE_BB6FB71E_91386409n,
  n_mask: createMask(251),
  h: 1n,
  n_bit_length: 521,
})

// * SEC-1 Binary Curves

export const sect163k1: F2mECParams = Object.freeze({
  m: 163,
  f: (x: bigint) => x ** 163n + x ** 7n + x ** 6n + x ** 3n + 1n,
  a: 0x1n,
  b: 0x1n,
  G: {
    x: 0x02FE13C0537BBC11ACAA07D793DE4E6D5E5C94EEE8n,
    y: 0x0289070FB05D38FF58321F2E800536D538CCDAA3D9n,
  },
  n: 0x04000000000000000000020108A2E0CC0D99F8A5EFn,
  n_mask: createMask(163),
  n_bit_length: 163,
  h: 2n,
})

// * NIST Prime Curves

export const p192 = secp192r1
export const p224 = secp224r1
export const p256 = secp256r1
export const p384 = secp384r1
export const p521 = secp521r1

// * Brainpool Prime Curves

export const bp160r1: FpECParams = Object.freeze({
  p: 0xE95E4A5F737059DC60DFC7AD95B3D8139515620Fn,
  a: 0x340E7BE2A280EB74E2BE61BADA745D97E8F7C300n,
  b: 0x1E589A8595423412134FAA2DBDEC95C8D8675E58n,
  G: {
    x: 0xBED5AF16EA3F6A4F62938C4631EB5AF7BDBCDBC3n,
    y: 0x1667CB477A1A8EC338F94741669C976316DA6321n,
  },
  n: 0xE95E4A5F737059DC60DF5991D45029409E60FC09n,
  n_mask: createMask(160),
  n_bit_length: 160,
  h: 1n,
})

export const bp192r1: FpECParams = Object.freeze({
  p: 0xC302F41D932A36CDA7A3463093D18DB78FCE476DE1A86297n,
  a: 0x6A91174076B1E0E19C39C031FE8685C1CAE040E5C69A28EFn,
  b: 0x469A28EF7C28CCA3DC721D044F4496BCCA7EF4146FBF25C9n,
  G: {
    x: 0xC0A0647EAAB6A48753B033C56CB0F0900A2F5C4853375FD6n,
    y: 0x14B690866ABD5BB88B5F4828C1490002E6773FA2FA299B8Fn,
  },
  n: 0xC302F41D932A36CDA7A3462F9E9E916B5BE8F1029AC4ACC1n,
  n_mask: createMask(192),
  n_bit_length: 192,
  h: 1n,
})

export const bp224r1: FpECParams = Object.freeze({
  p: 0xD7C134AA264366862A18302575D1D787B09F075797DA89F57EC8C0FFn,
  a: 0x68A5E62CA9CE6C1C299803A6C1530B514E182AD8B0042A59CAD29F43n,
  b: 0x2580F63CCFE44138870713B1A92369E33E2135D266DBB372386C400Bn,
  G: {
    x: 0x0D9029AD2C7E5CF4340823B2A87DC68C9E4CE3174C1E6EFDEE12C07Dn,
    y: 0x58AA56F772C0726F24C6B89E4ECDAC24354B9E99CAA3F6D3761402CDn,
  },
  n: 0xD7C134AA264366862A18302575D0FB98D116BC4B6DDEBCA3A5A7939Fn,
  n_mask: createMask(224),
  n_bit_length: 224,
  h: 1n,
})

export const bp256r1: FpECParams = Object.freeze({
  p: 0xA9FB57DBA1EEA9BC3E660A909D838D726E3BF623D52620282013481D1F6E5377n,
  a: 0x7D5A0975FC2C3057EEF67530417AFFE7FB8055C126DC5C6CE94A4B44F330B5D9n,
  b: 0x26DC5C6CE94A4B44F330B5D9BBD77CBF958416295CF7E1CE6BCCDC18FF8C07B6n,
  G: {
    x: 0x8BD2AEB9CB7E57CB2C4B482FFC81B7AFB9DE27E1E3BD23C23A4453BD9ACE3262n,
    y: 0x547EF835C3DAC4FD97F8461A14611DC9C27745132DED8E545C1D54C72F046997n,
  },
  n: 0xA9FB57DBA1EEA9BC3E660A909D838D718C397AA3B561A6F7901E0E82974856A7n,
  n_mask: createMask(256),
  n_bit_length: 256,
  h: 1n,
})

export const bp320r1: FpECParams = Object.freeze({
  p: 0xD35E472036BC4FB7E13C785ED201E065F98FCFA6F6F40DEF4F92B9EC7893EC28FCD412B1F1B32E27n,
  a: 0x3EE30B568FBAB0F883CCEBD46D3F3BB8A2A73513F5EB79DA66190EB085FFA9F492F375A97D860EB4n,
  b: 0x520883949DFDBC42D3AD198640688A6FE13F41349554B49ACC31DCCD884539816F5EB4AC8FB1F1A6n,
  G: {
    x: 0x43BD7E9AFB53D8B85289BCC48EE5BFE6F20137D10A087EB6E7871E2A10A599C710AF8D0D39E20611n,
    y: 0x14FDD05545EC1CC8AB4093247F77275E0743FFED117182EAA9C77877AAAC6AC7D35245D1692E8EE1n,
  },
  n: 0xD35E472036BC4FB7E13C785ED201E065F98FCFA5B68F12A32D482EC7EE8658E98691555B44C59311n,
  n_mask: createMask(320),
  n_bit_length: 320,
  h: 1n,
})

export const bp384r1: FpECParams = Object.freeze({
  p: 0x8CB91E82A3386D280F5D6F7E50E641DF152F7109ED5456B412B1DA197FB71123ACD3A729901D1A71874700133107EC53n,
  a: 0x7BC382C63D8C150C3C72080ACE05AFA0C2BEA28E4FB22787139165EFBA91F90F8AA5814A503AD4EB04A8C7DD22CE2826n,
  b: 0x04A8C7DD22CE28268B39B55416F0447C2FB77DE107DCD2A62E880EA53EEB62D57CB4390295DBC9943AB78696FA504C11n,
  G: {
    x: 0x1D1C64F068CF45FFA2A63A81B7C13F6B8847A3E77EF14FE3DB7FCAFE0CBD10E8E826E03436D646AAEF87B2E247D4AF1En,
    y: 0x8ABE1D7520F9C2A45CB1EB8E95CFD55262B70B29FEEC5864E19C054FF99129280E4646217791811142820341263C5315n,
  },
  n: 0x8CB91E82A3386D280F5D6F7E50E641DF152F7109ED5456B31F166E6CAC0425A7CF3AB6AF6B7FC3103B883202E9046565n,
  n_mask: createMask(384),
  n_bit_length: 384,
  h: 1n,
})

export const bp512r1: FpECParams = Object.freeze({
  p: 0xAADD9DB8DBE9C48B3FD4E6AE33C9FC07CB308DB3B3C9D20ED6639CCA703308717D4D9B009BC66842AECDA12AE6A380E62881FF2F2D82C68528AA6056583A48F3n,
  a: 0x7830A3318B603B89E2327145AC234CC594CBDD8D3DF91610A83441CAEA9863BC2DED5D5AA8253AA10A2EF1C98B9AC8B57F1117A72BF2C7B9E7C1AC4D77FC94CAn,
  b: 0x3DF91610A83441CAEA9863BC2DED5D5AA8253AA10A2EF1C98B9AC8B57F1117A72BF2C7B9E7C1AC4D77FC94CADC083E67984050B75EBAE5DD2809BD638016F723n,
  G: {
    x: 0x81AEE4BDD82ED9645A21322E9C4C6A9385ED9F70B5D916C1B43B62EEF4D0098EFF3B1F78E2D0D48D50D1687B93B97D5F7C6D5047406A5E688B352209BCB9F822n,
    y: 0x7DDE385D566332ECC0EABFA9CF7822FDF209F70024A57B1AA000C55B881F8111B2DCDE494A5F485E5BCA4BD88A2763AED1CA2B2FA8F0540678CD1E0F3AD80892n,
  },
  n: 0xAADD9DB8DBE9C48B3FD4E6AE33C9FC07CB308DB3B3C9D20ED6639CCA70330870553E5C414CA92619418661197FAC10471DB1D381085DDADDB58796829CA90069n,
  n_mask: createMask(512),
  n_bit_length: 512,
  h: 1n,
})
